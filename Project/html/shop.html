<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop</title>
    <link rel="stylesheet" href="../css/shop.css" />
  </head>
  <body>
    <!-- Header -->
    <div id="header">
      <div class="header-left">
        <a href="../html/home.html">
          <img
            src="https://img.icons8.com/sf-regular-filled/48/FFFFFF/ghost.png"
            alt=""
          />
        </a>
      </div>
      <div class="header-center">
        <div class="home">
          <h1><a href="../html/home.html">Home</a></h1>
        </div>
        <div class="shop">
          <h1><a href="../html/preshop.html">Shop</a></h1>
          <div class="shop-dropdown">
            <ul>
              <a href="../html/detailproduct.html?id=0"><li>Witch's hat</li></a>
              <a href="../html/detailproduct.html?id=1"
                ><li>Witch's cape</li></a
              >
              <a href="../html/detailproduct.html?id=2"
                ><li>Witch's broom</li></a
              >
            </ul>
            <ul>
              <a href="../html/detailproduct.html?id=3"
                ><li>Jack-o'-lantern</li></a
              >
              <a href="../html/detailproduct.html?id=4"
                ><li>Ghost light bulb</li></a
              >
              <a href="../html/detailproduct.html?id=5"><li>Wall clock</li></a>
            </ul>
            <ul>
              <a href="../html/detailproduct.html?id=6"
                ><li>Stuffed toys</li></a
              >
              <a href="../html/detailproduct.html?id=7"
                ><li>Candy bucket</li></a
              >
              <a href="../html/detailproduct.html?id=8"
                ><li>Message card</li></a
              >
            </ul>
            <h2 class="corner-1">ðŸŽƒ</h2>
            <h2 class="corner-2">ðŸŽƒ</h2>
            <h2 class="corner-3">ðŸŽƒ</h2>
            <h2 class="corner-4">ðŸŽƒ</h2>
          </div>
        </div>
        <div class="contact">
          <h1><a href="../html/contact.html">Contact</a></h1>
        </div>
      </div>

      <div class="header-right">
        <div id="search-container">
          <input
            type="search"
            placeholder="Search - Products"
            id="search-input"
          />
          <div id="search-list"></div>
        </div>
        <div class="cart">
          <a href="../html/cart.html">
            <img
              src="https://img.icons8.com/sf-black-filled/64/FFFFFF/shopping-cart-loaded.png"
              alt=""
            />
          </a>
          <h2 id="total-quantity"></h2>
        </div>
        <div class="account">
          <img
            src="https://img.icons8.com/external-anggara-glyph-anggara-putra/32/FFFFFF/external-account-social-media-interface-anggara-glyph-anggara-putra.png"
            alt=""
            onclick="showAccount()"
          />
          <div id="account">
            <a href="../html/cart.html"><h2>Your cart</h2></a>
            <a href="../html/signup.html"><h2>Create a new account</h2></a>
            <h2 id="sign-out" onclick="signOut()">Sign out</h2>
          </div>
        </div>
      </div>
    </div>

    <div id="account">
      <a href="../html/cart.html"><h2>Your cart</h2></a>
      <a href="../html/login.html"><h2>Log in</h2></a>
      <a href="../html/signup.html"><h2>Create a new account</h2></a>
      <h2 id="sign-out">Sign out</h2>
    </div>

    <!-- Content -->
    <h1 class="big-title">ðŸ‘» WELCOME TO OUR SHOP ðŸ‘»</h1>
    <div id="container-categories">
      <h1>Categories</h1>
      <div><span id="costume">Costume</span></div>
      <div><span id="decoration">Decoration</span></div>
      <div><span id="toy">Toy</span></div>
      <div><span id="show-all">Show all</span></div>
    </div>
    <div id="container-product">
      <ul
        id="big-row-costume"
        style="display: flex; gap: 20px; margin-bottom: 20px"
      >
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/95/84/99/9584997a93ba676f783b9ffaa10076db.jpg"
            />
            <button id="Witch's hat" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=0"
            ><h2 class="product-name">Witch's hat</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/87/51/ec/8751ecb2e6fd3f868f5b8665c293a0ac.jpg"
            />
            <button id="Witch's cape" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=1"
            ><h2 class="product-name">Witch's cape</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/f4/ba/82/f4ba824c042da7758cc0c82256a633ee.jpg"
            />
            <button id="Witch's broom" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=2"
            ><h2 class="product-name">Witch's broom</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
      </ul>

      <ul
        id="big-row-decoration"
        style="display: flex; gap: 20px; margin-bottom: 20px"
      >
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/15/1a/1b/151a1b18682b0b13f6c2afceca4fc2ee.jpg"
            />
            <button id="Jack-o'-lantern" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=3"
            ><h2 class="product-name">Jack-o'-lantern</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/a8/23/27/a82327f07ee014d91da80af57b5621fc.jpg"
            />
            <button id="Ghost light bulb" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=4"
            ><h2 class="product-name">Ghost light bulb</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/07/1d/78/071d789e36c74be34566bc879e2abaf7.jpg"
            />
            <button id="Wall clock" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=5"
            ><h2 class="product-name">Wall clock</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
      </ul>

      <ul
        id="big-row-toy"
        style="display: flex; gap: 20px; margin-bottom: 20px"
      >
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/a1/59/06/a15906ac687277f869ad56d5fd0fe671.jpg"
            />
            <button id="Stuffed toys" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=6"
            ><h2 class="product-name">Stuffed toys</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/c2/d7/b9/c2d7b9467d797b9363455a3486e42d55.jpg"
            />
            <button id="Candy bucket" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=7"
            ><h2 class="product-name">Candy bucket</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
        <li class="product">
          <div class="product-img-cover">
            <img
              class="product-img"
              src="https://i.pinimg.com/564x/e5/81/de/e581def54bb43f921a2634dcf3502c9c.jpg"
            />
            <button id="Message card" class="add-instant">+1</button>
          </div>
          <a href="../html/detailproduct.html?id=8"
            ><h2 class="product-name">Message card</h2></a
          >
          <h2>10.000 VND</h2>
        </li>
      </ul>
    </div>

    <!-- Footer -->
    <section id="footer">
      <h1>About us</h1>
      <h1>Contact us</h1>
      <div class="social-media">
        <img
          src="https://img.icons8.com/color/48/000000/facebook-new.png"
          alt=""
        />
        <img
          src="https://img.icons8.com/color/48/000000/youtube-play.png"
          alt=""
        />
        <img
          src="https://img.icons8.com/fluency/48/000000/instagram-new.png"
          alt=""
        />
      </div>
      <a href="../html/ticket.html"
        ><button class="buy-now-btn-3">BUY YOUR TICKETS NOW</button></a
      >
    </section>

    <script src="../javascript/shop.js"></script>
    <script type="module" src="../javascript/auth.js"></script>
    <script type="module">
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        child,
        get,
        remove,
      } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

      onAuthStateChanged(auth, (user) => {
        if (user) {
          console.log(user);
        } else {
        }
      });

      var addInstant = document.getElementsByClassName("add-instant");
      for (let i = 0; i < 9; i++) {
        addInstant[i].onclick = function (e) {
          console.log(addInstant[i].id);
          const userID = auth.currentUser.uid;
          const database = getDatabase();
          const dbRef = ref(database);
          var addInstantBtn = e.target;
          addInstantBtn.disabled = true;
          addInstantBtn.textContent = "...";

          var productRD = {
            title: addInstant[i].id,
            number: 1,
            money: 10,
          };

          get(child(dbRef, `cart/${userID}`))
            .then((snapshot) => {
              if (snapshot.exists()) {
                var dataFromRD = snapshot.val();
                var findDuplicatedItem = dataFromRD.filter(
                  (product) => product.title == productRD.title
                );
                var findNonduplicatedItem = dataFromRD.filter(
                  (product) => product.title != productRD.title
                );
                if (findDuplicatedItem.length > 0) {
                  dataFromRD.push(productRD);
                  var productAdd = {
                    title: findDuplicatedItem[0].title,
                    number: findDuplicatedItem[0].number + 1,
                    money: findDuplicatedItem[0].money + 10,
                  };
                  findNonduplicatedItem.push(productAdd);
                  alert(
                    "You added " +
                      productRD.number +
                      " " +
                      productRD.title +
                      " to cart"
                  );
                  set(ref(database, `cart/${userID}`), findNonduplicatedItem);
                  localStorage.setItem(
                    "List Product",
                    JSON.stringify(findNonduplicatedItem)
                  );
                  location.reload();
                } else {
                  dataFromRD.push(productRD);
                  alert(
                    "You added " +
                      productRD.number +
                      " " +
                      productRD.title +
                      " to cart"
                  );
                  set(ref(database, `cart/${userID}`), dataFromRD);
                  localStorage.setItem(
                    "List Product",
                    JSON.stringify(dataFromRD)
                  );
                  location.reload();
                }
              } else {
                console.log("No data available");
                listProductRD.push(productRD);
                alert(
                  "You added " +
                    productRD.number +
                    " " +
                    productRD.title +
                    " to cart"
                );
                set(ref(database, `cart/${userID}`), listProductRD);
                localStorage.setItem(
                  "List Product",
                  JSON.stringify(listProductRD)
                );
                location.reload();
              }
              addInstantBtn.disabled = false;
              addInstantBtn.textContent = "+1";
            })
            .catch((error) => {
              console.error(error);
            });
        };
      }
    </script>
  </body>
</html>
